# Сервис управления рассылками

Сервис, который запускает рассылку по списку клиентов  по заданным правилам :
- После создания новой рассылки, если текущее время больше времени начала и меньше времени окончания - из справочника выбираются все клиенты, которые подходят под значения фильтра, указанного в этой рассылке и запускается отправка для всех этих клиентов. Для отправки использовать сообщение, которое прикреплено к рассылке.
- Если создаётся рассылка с временем старта в будущем - отправка стартует автоматически по наступлению этого времени без дополнительных действий со стороны пользователя системы.
- Если по каким-то причинам не успели разослать все сообщения - никакие сообщения клиентам после этого времени не доставляются.

### Установка и запуск локальной версии с помощью docker-compose
Клонируйте репозиторий:
```shell
git clone https://github.com/evgen4ikrus/messages-sending-service.git
```
Скачайте и соберите докер-образы с помощью Docker-Сompose:
```shell
docker-compose build
``` 
Запустите докер-контейнеры:
``` shell
docker compose up
```
В новом терминале накатите свежие миграции БД:
```shell
docker compose run --rm django ./manage.py migrate
```
Вход в админку находится по адресу http://0.0.0.0:8000/admin/

Вы можете загрузить тестовую базу данных:
```shell
docker compose run --rm django ./manage.py loaddata db.json
```
В тестовой БД уже создан суперпользователь с логином `root`, паролем `123` (воспользуйтесь для входа в админку).

Запустите скрипт рассылки сообщений:
```shell
docker compose run --rm django ./manage.py run_mailing
```
Скрипт будет отправлять сообщения для клиентов в консоль.

### Переменные окружения
Для локально версии приложения все переменные окружения заданы по умолчанию, но вы можете их переопределить. Для этого создайте файл .env в корневой папке проекта и добавьте переменные в формате КЛЮЧ=ЗНАЧЕНИЕ:
```
# Пример:
DEBUG=True
SECRET_KEY=django-insecure-0if40nf4nf93n4
ALLOWED_HOSTS=0.0.0.0
POSTGRES_PASSWORD=123
POSTGRES_USER=root
POSTGRES_NAME=postgres
DATABASE_URL=postgres://root:123@db_auth:/postgres
```
